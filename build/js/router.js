define(["lodash","backbone","jquery","game","js/enum","js/views/welcome","js/views/level","js/views/levels","js/views/gameOver","js/views/error","js/views/oldBrowserError"],function(e,i,n,r,t,o,s,w,u,c,a){var l=i.Router.extend({currentView:null,$container:null,routes:{"":"setDefault",welcome:"welcome","error(/:errorType)":"error",levels:"levels","level/:number":"level",gameOver:"gameOver"},initialize:function(){this.$container=n("#content")},setDefault:function(){this.navigate("welcome",{trigger:!0})},welcome:function(){this.hideCurrentView(),this.showView(o)},error:function(i){var n,r=e.parseInt(i);switch(r){case t.GameErrorTypes.OLD_BROWSER:return this.forceRemoveView(this.currentView),this.showView(a);default:n=c}this.hideCurrentView(),this.showView(n,r)},level:function(i){r.onInitialize(e.bind(function(){r.navigateToLevel(~~i)},this))},levels:function(){r.onInitialize(e.bind(function(){this.hideCurrentView(),this.showView(w)},this))},gameOver:function(){this.hideCurrentView(),this.showView(u)},hideCurrentView:function(){var e=this.currentView,i=this;return e?n.when(e.hide()).always(function(){i.forceRemoveView(e)}):(new n.Deferred).resolve()},forceRemoveView:function(i){i&&e.isFunction(i.remove)&&i.remove()},showView:function(i){var r,o,s=new n.Deferred,w=this;return this.currentView=new(Function.prototype.bind.apply(i,[null].concat(Array.prototype.slice.call(arguments,1)))),n.when(this.currentView.prepareData()).then(function(){function i(){n.when(w.currentView.show()).always(function(){s.resolve()})}r=w.currentView.render(),r?(o=r.find(".postRender"),o.length?o.one("animationend webkitAnimationEnd",e.bind(i,w)):i(),w.$container.append(r)):s.resolve()},function(e){var i=e.code||t.GameErrorTypes.GENERIC;w.navigate("error/"+i,{trigger:!0})}),s},showLevelView:function(e){return this.showView(s,e)}});return l});